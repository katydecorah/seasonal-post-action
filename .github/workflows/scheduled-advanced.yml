name: Seasonal scheduled post

on:
  schedule:
    - cron: "00 02 20 Mar,Jun,Sep,Dec *"

jobs:
  scheduled-post:
    runs-on: ubuntu-latest
    name: Write scheduled post
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setpost title and date
        run: |
          MONTH=$(date +%m)
          YEAR=$(date +%Y)
          case $MONTH in
            03)
              echo "POST_TITLE=$(($YEAR - 1))/${YEAR} Winter" >> $GITHUB_ENV
              echo "START_DATE=$(($YEAR - 1))-12-20" >> $GITHUB_ENV
              echo "END_DATE=${YEAR}-03-20" >> $GITHUB_ENV
              ;;
            06)
              echo "POST_TITLE=${YEAR} Spring" >> $GITHUB_ENV
              echo "START_DATE=${YEAR}-03-20" >> $GITHUB_ENV
              echo "END_DATE=${YEAR}-06-20" >> $GITHUB_ENV
              ;;
            09)
              echo "POST_TITLE=${YEAR} Summer" >> $GITHUB_ENV
              echo "START_DATE=${YEAR}-06-20" >> $GITHUB_ENV
              echo "END_DATE=${YEAR}-09-20" >> $GITHUB_ENV
              ;;
            12)
              echo "POST_TITLE=${YEAR} Fall" >> $GITHUB_ENV
              echo "START_DATE=${YEAR}-09-20" >> $GITHUB_ENV
              echo "END_DATE=${YEAR}-12-20" >> $GITHUB_ENV
              ;;
          esac
      - name: Write scheduled post
        uses: ./
        with:
          github-username: katydecorah
          github-repository: archive
          source-bookmarks: recipes|_data/recipes.json
          book-tags: "recommend,skip"
          start-date: ${{ env.START_DATE }}
          end-date: ${{ env.END_DATE }}
          post-title: ${{ env.POST_TITLE }}
        env:
          TOKEN: ${{ secrets.TOKEN }}
      - name: Commit files
        run: |
          git pull
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A && git commit -m "${{ env.POST_TITLE }}"
          git push
